# Dodohahaclassic

   Это программное решение разработано на Kotlin с применением Spring Boot для управления рестораном. Оно предоставляет
возможности для двух категорий пользователей: посетителей и администраторов. Система
обрабатывает заказы с использованием многопоточности, обеспечивая клиентам возможность динамически формировать заказы и
отслеживать их статус. Администраторам предоставляется контроль над меню, включая добавление, удаление и настройку блюд,
а также определение их цены и времени приготовления.

## Начало работы

1. **Запуск приложения:**
    ```bash
    ./gradlew bootRun
    ```
2. **Swagger:**
   Перейти в браузер по ссылке: http://localhost:8080

## Основные функции

### Общее

1. **Аутентификация и управление пользователями:**
    - Возможность регистрации и входа в систему.
    - Возможность выхода из системы.

2. **Управление меню:**
    - Просмотр списка всех блюд в меню.

### Для администраторов

1. **Управление блюдами:**
    - Добавление новых блюд в меню.
    - Удаление блюд из меню.
    - Установка количества, цены и сложности приготовления для блюд.

2. **Анализ статистики:**
    - Отображение общего количества заказов и доходности.
    - Просмотр списка самых популярных блюд.
    - Сортировка заказов по рейтингу.
    - Расчёт средней стоимости заказа.

### Для клиентов

1. **Создание и управление заказами:**
    - Создание заказов из доступного меню.
    - Добавление блюд в заказ во время его формирования.
    - Отмена и редактирование заказов до их готовности.
    - Оплата заказов после завершения.

2. **Отзывы и просмотр заказов:**
    - Возможность написания отзывов о заказах после оплаты.

## Структура проекта

Проект придерживается принципов ООП и SOLID:

- `controllers`: Контроллеры для обработки HTTP-запросов и ответов.
- `domain/controllers`: Шаблоны запросов и ответов для всех контроллеров.
- `domain/enums`: Перечисления, определяющие константные значения.
- `interfaces`: Интерфейсы, определяющие контракты для классов или компонентов.
- `domain/models`: Классы данных, представляющие сущности (например, User, Dish, Order).
- `repositories`: Реализация шаблона репозитория для хранения и извлечения данных.
- `resources`: JSON-файлы с данными.
- `services`: Классы с бизнес-логикой для обработки действий пользователей и заказов.
- `helpers`: Вспомогательные инструменты и утилиты.
- `modules`: Пакет для внедрения зависимостей.
- `exception`: Кастомные исключения приложения.

Использование JSON-файлов для хранения данных упрощает задачу. Тем не менее, в проекте применяется шаблон проектирования
репозитория для управления данными.

## Аутентификация

Система обеспечивает аутентификацию как для посетителей, так и для администраторов. Посетители имеют возможность
зарегистрироваться или войти в систему, используя свои учетные данные. Администраторы обладают дополнительными
привилегиями, такими как управление меню, доступ к статистике ресторана.

## Шаблоны проектирования

Проект применяет разнообразные шаблоны проектирования для обеспечения чистоты и поддерживаемости кода:

- **Onion – архитектура:** Используется как основной паттерн для проектирования веб-сервиса.
- **Шаблон репозитория:** Применяется для доступа к данным и их хранения.
- **Singleton:** Используется для хранения информации о ресторане.

## Многопоточность

Сервис `OrderBackgroundService` предназначен для обработки заказов в многопоточном режиме. При получении нового заказа
метод `processOrder` запускает подготовку заказа в фоновом режиме.

Внутри метода `processOrder` каждый заказ обрабатывается в отдельном потоке. Поток ожидает начала приготовления блюда,
включая время на запись заказа, перемещение официантки, подготовку поваров и т.д. По прошествии этого времени, начиная с
момента начала приготовления заказа, отмена или внесение изменений в заказ становится невозможным. Затем происходит
расчет общего времени приготовления заказа путем суммирования времени приготовления каждого блюда. После завершения
приготовления статус заказа обновляется, а доход ресторана обновляется в соответствии с ценой заказа.

Метод `cancel` используется для отмены обработки заказа, если он находится в процессе приготовления.

Приоритет обработки заказов определяется по простой очереди: заказ, сделанный первым, обрабатывается первым.
